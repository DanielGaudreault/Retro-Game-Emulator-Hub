<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro ROM Player</title>
    <style>
        /* Add all the CSS from previous examples */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Press Start 2P', cursive; }
        body { background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); color: #fff; min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; padding: 20px 0; margin-bottom: 30px; border-bottom: 4px solid #ff0080; }
        h1 { font-size: 2.5rem; color: #00ffff; text-shadow: 3px 3px 0 #ff0080; margin-bottom: 10px; }
        .upload-section { background: rgba(0, 0, 0, 0.7); border-radius: 10px; padding: 20px; border: 2px solid #00ffff; }
        .game-screen { width: 100%; background: #000; border: 5px solid #ffcc00; height: 400px; position: relative; }
        /* Add remaining CSS styles from previous examples */
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>RETRO ROM PLAYER</h1>
            <p class="tagline">Upload and play your favorite classic games</p>
        </header>

        <div class="main-content">
            <div class="upload-section">
                <h2>UPLOAD ROM</h2>
                <div class="drop-zone" id="dropZone">
                    <input type="file" id="fileInput" accept=".nes,.gb,.gbc,.gba,.smc,.sfc,.md,.gen,.a26,.bin,.zip">
                    <button id="uploadBtn">UPLOAD ROM</button>
                </div>
                <div id="uploadStatus"></div>
            </div>

            <div class="game-section">
                <div class="game-screen">
                    <canvas id="gameCanvas" width="640" height="480"></canvas>
                    <div id="emulatorStatus">Select and upload a ROM file to begin</div>
                </div>
                <div class="controls">
                    <button id="loadBtn" disabled>LOAD GAME</button>
                    <button id="startBtn" disabled>START</button>
                    <button id="resetBtn" disabled>RESET</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Frontend JavaScript
        document.getElementById('uploadBtn').addEventListener('click', async () => {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a ROM file');
                return;
            }

            const formData = new FormData();
            formData.append('rom', file);

            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('uploadStatus').textContent = 
                        `ROM uploaded successfully! Game: ${result.gameName}`;
                    document.getElementById('loadBtn').disabled = false;
                    localStorage.setItem('currentRom', result.filename);
                } else {
                    document.getElementById('uploadStatus').textContent = 
                        `Upload failed: ${result.error}`;
                }
            } catch (error) {
                document.getElementById('uploadStatus').textContent = 
                    `Upload error: ${error.message}`;
            }
        });

        document.getElementById('loadBtn').addEventListener('click', async () => {
            const filename = localStorage.getItem('currentRom');
            if (!filename) return;

            try {
                const response = await fetch('/api/load-rom', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ filename: filename })
                });

                const result = await response.json();
                
                if (result.success) {
                    // Initialize the emulator with the ROM data
                    initializeEmulator(result.romData);
                    document.getElementById('startBtn').disabled = false;
                }
            } catch (error) {
                console.error('Error loading ROM:', error);
            }
        });

        function initializeEmulator(romData) {
            // This would interface with a JavaScript emulator
            const canvas = document.getElementById('gameCanvas');
            const status = document.getElementById('emulatorStatus');
            
            status.textContent = 'ROM loaded successfully! Click START to play.';
            
            // Here you would initialize your chosen emulator
            // For example, if using JSNES:
            // const nes = new JSNES();
            // nes.loadROM(romData);
            // nes.start();
        }
    </script>

    <!-- Include emulator libraries -->
    <script src="https://unpkg.com/jsnes/dist/jsnes.min.js"></script>
</body>
</html>
